#Harnessing Deep Bladder Tumor Segmentation with Logical Clinical Knowledge
**摘要：**从磁共振 (MR) 图像分割膀胱肿瘤对于早期发现和辅助诊断膀胱癌很重要。深度卷积神经网络 (DCNNs) 已广泛用于膀胱肿瘤分割，但基于DCNN的肿瘤分割过度依赖于数据训练，而忽略了临床知识。从临床角度来看，膀胱肿瘤必须依靠膀胱壁才能生存和生长，而域先验对膀胱肿瘤的定位非常有帮助。针对该问题，我们提出了一种**新颖的膀胱肿瘤分割方法，将膀胱肿瘤和壁的临床逻辑规则纳入DCNN中，并利用临床规则对DCNN进行分割。逻辑规则为人类临床医生提供了语义和友好的知识表示，易于设置和理解。**==此外，融合临床知识的逻辑规则有助于减少分割网络的数据依赖性，并即使使用有限的标记训练图像也能获得精确的分割结果==。在合作医院的膀胱MR图像上进行的实验验证了所提出的肿瘤分割方法的有效性。

### 介绍

膀胱癌是泌尿外科常见肿瘤之一。早期发现和清除膀胱肿瘤对于膀胱癌治疗至关重要。磁共振图像的肿瘤分割是实现膀胱肿瘤智能检测和测量的关键技术。由于图像特征学习的优越性，深度卷积神经网络 (DCNNs) 已被广泛用于分析膀胱MR图像，用于膀胱肿瘤分割 [13,15]，检测 [1,20] 和辅助诊断 [7,9]。

为了改善模型解释并减少数据依赖性，**研究人员试图将包括大小，形状和空间先验在内的领域知识纳入医学图像分割的dcnn中 [11,16，17,22，23]。**从领域知识利用的角度来看，基于DCNN的膀胱肿瘤分割方法可分为数据驱动和数据知识融合两类。

==纯数据驱动的分割方法仅基于标记训练图像直接构建肿瘤分割模型。==Ge等和Dolz等 [5] 联合扩张卷积改进膀胱肿瘤分割模型。*数据驱动的分割方法依赖于数据训练，不能应用于标记医学图像不足的场景中。*相反，数据知识融合方法将领域知识整合到肿瘤分割模型中，并且对标记图像数据的依赖性较小。

**Huang等结合注意机制制定了膀胱肿瘤大小和位置分布的域先验，并将先验整合到DCNN中以限制肿瘤分割 [10]。**Li等。利用自动编码器网络来学习膀胱的语义特征作为先验，然后将先验纳入分割网络 [13]。尽管将领域先验纳入dcnn可以提高分割性能，但相关的数据知识融合方法仍然存在两个缺点。首先，知识以参数设置，优化约束，注意机制和概率分布的形式表示，这是从临床医生那里获取知识的重点。例如，对于人类医生来说，准确地描述和理解模型优化的先验约束是很难的。其次，某些知识的提取仍然需要大量的标记数据，例如从大量标记图像中学到的注意先验信息和概率分布。

为了解决知识表示的缺点，本文提出了一种新颖的膀胱肿瘤分割方法，其中将临床知识的逻辑规则纳入dcnn中。作为人类思维的一种自然方式，逻辑规则提供了语义和人类友好的知识表示。已经验证了符号逻辑规则可以有效地融合到深度神经网络中，以提高其分类性能 [4,21]。Zhang等 [24] 使用逻辑规则对膀胱肿瘤癌分期进行分类，效果良好，但他们的方法不能直接用于分割任务。在提出的方法中，我们首先从地面真相的分割面具中以逻辑规则的形式提取膀胱肿瘤和壁的临床知识。然后，我们训练图卷积网络以将逻辑规则嵌入到潜在特征空间中。之后，我们重建了分割网络的损失函数，以最小化真实分割的逻辑规则嵌入与预测分割之间的差异，从而使用逻辑规则来指导网络的肿瘤分割。

据我们所知，**将逻辑规则纳入dcnn以进行医学图像分割的相关工作非常有限。与其他知识表示相比，临床知识的逻辑规则对人类临床医生而言更加语义和友好。**此外，融合临床知识的逻辑规则有助于减少分割网络的数据依赖性，并即使使用有限的标记训练图像也能获得精确的分割结果。在合作医院的膀胱MR图像上进行的实验验证了所提出的肿瘤分割方法的有效性。

### 方法

在本节中，我们介绍如何将临床逻辑规则整合到dcnn中，以指导膀胱肿瘤的分割。如图1所示，所提出的分割方法的框架由两部分组成。左部分是骨干网分割网络，如Unet，右部分是临床逻辑知识提取模型。首先，我们从地面真相和预测的分割掩模中提取与膀胱肿瘤和膀胱壁相关的逻辑规则。然后，我们将逻辑规则转换为图形，并使用图形卷积网络将其嵌入到潜在特征空间中。通过缩小由地面真相引起的逻辑规则的潜在特征与预测分割之间的差距，我们使分割结果与逻辑规则一致。下面列出了分段的总体损失函数，其中第一项用于衡量分段误差，第二项用于衡量逻辑规则的一致性，β 是平衡因子。

<img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\1668392590174.png" alt="1668392590174" style="zoom:80%;" />

<img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\1668392874184.png" alt="1668392874184" style="zoom:80%;" />

#### 2.1构建膀胱肿瘤定位的逻辑规则

**从临床角度来看，膀胱肿瘤必须依靠膀胱壁才能生存和生长。肿瘤附着在膀胱壁上的临床知识可以帮助我们定位膀胱肿瘤。**膀胱肿瘤定位的逻辑规则定义为命题公式。一个命题公式F是由逻辑连接词 {¬，∧， ∨ ，⇒，⇔} 连接的命题变量的组合。令p1，p2，...，pn是在命题公式F中出现的n个命题变量，pi是一个陈述，它是真或假。将公式映射为true或false的命题变量的设置值称为赋值。我们定义了两种类型的膀胱肿瘤定位命题，如下所示。

-存在命题指示对象是否存在于分割掩模中，例如存在 (肿瘤) 和存在 (膀胱壁)。-空间命题表示两个对象的相对空间关系，其包括 {in，out，nearby}，例如in (肿瘤，壁)，out (肿瘤，壁) 和nearby (肿瘤，壁)。

结合存在和空间命题，我们可以构建膀胱肿瘤定位的逻辑规则，如 (存在 (肿瘤) ⇒ 存在 (壁)) ∧ (存在 (肿瘤) ⇔ 在 (肿瘤，wall)里)，以表示膀胱壁内部存在肿瘤。&#39;⇒&#39; 和 &#39;⇔&#39; 是逻辑含义，规则可以同样转化为命题公式 (¬ exist (肿瘤)  ∨ (exist(wall) Λ in (肿瘤，wall) ∧ (¬ in (肿瘤，壁)  ∨exist (肿瘤))。采用p1，p2和p3来简要表示存在 (肿瘤)，存在 (壁) 和 (肿瘤，框) 中的命题，我们可以得到规则为 (¬ p1 ∨ (p2 ∧ p3)) ∧ (¬ p3 ∧ p1)。此外，我们可以通过树在结构上表示命题公式，其中叶节点由命题pi或¬pi组成，而内部节点是逻辑运算 Λ 和 ∨。

此外，逻辑规则的二进制命题变量反映了整个图像的信息，这些信息过于粗糙，无法表示膀胱肿瘤的详细信息。例如二元命题exist (肿瘤) 只能表示肿瘤是否存在，而不能表示肿瘤存在的位置。因此，我们进一步将一个二元命题变量pi扩展到一个K维向量pi 1，...，pi k，...，pi K，其中每个元素pi k表示肿瘤是否存在于图像中的第K个局部区域。在基于DCNN的图像分割中，我们通过将医学图像输入多个最大池化模块来生成命题变量的向量。总结向量中局部区域的所有二元命题变量，我们可以计算整个图像的命题变量pi。

形成膀胱肿瘤逻辑规则表示的工作流程如图2(b) 所示。

#### 2.2将逻辑规则嵌入到潜在特征中

如上所述，对于命题公式的临床逻辑规则，我们可以用树表示规则，并利用图卷积网络 (GCN) [12] 将规则树嵌入到潜在特征空间中。在特征空间中，我们可以测量地面真相分割的规则嵌入与dcnn产生的预测分割之间的差异。嵌入逻辑规则的GCN构造为

<img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\1668395041740.png" alt="1668395041740" style="zoom:80%;" />

其中Z(l) 是层l-1输出的嵌入矩阵，Z(0) 被构造为全局嵌入向量和所有树节点的嵌入向量的组合。A是规则树的邻接矩阵，A〜 = a I，I是单位矩阵。此转换使邻接矩阵A能够考虑由节点本身引起的影响。D ~ 是入-出度矩阵，d ~ ii =  j a ~ ij。D ~ − 1 2 a ~ ~ d − 1 2表示由入-出度归一化的邻接矩阵。当前层的可训练权参数矩阵用W表示，σ 表示激活函数。